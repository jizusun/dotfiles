{{- if (eq .chezmoi.os "darwin") -}}

#!/bin/sh
brew bundle -v --no-lock --file=/dev/stdin <<EOF
brew "bitwarden-cli"
EOF
# brew: https://brew.sh/
# /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/
# if [[ "$(uname -s)" == "Linux" ]]; then BREW_TYPE="linuxbrew"; else BREW_TYPE="homebrew"; fi
# export HOMEBREW_BREW_GIT_REMOTE="https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git"
# export HOMEBREW_CORE_GIT_REMOTE="https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/${BREW_TYPE}-core.git"
# export HOMEBREW_BOTTLE_DOMAIN="https://mirrors.tuna.tsinghua.edu.cn/${BREW_TYPE}-bottles"
# git clone --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/install.git brew-install
# /bin/bash brew-install/install.sh
# rm -rf brew-install

{{ else if eq .chezmoi.os "linux" -}}

#!/bin/sh
# oh-my-zsh: https://ohmyz.sh/#install

if ! [ -x "$(command -v zsh)" ]; then
    echo 'installing zsh'
    sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi

git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k

# jump
go get github.com/gsamokovarov/jump

# add font for power10k
if ! [ -x "$(command -v fc-cache)" ]; then
    echo "[-] Download fonts [-]"
    sudo apt-get install fontconfig
    wget https://github.com/romkatv/powerlevel10k-media/raw/master/MesloLGS%20NF%20Regular.ttf
    mkdir -p  ~/.local/share/fonts/ 
    mv MesloLGS\ NF\ Regular.ttf ~/.local/share/fonts 
    fc-cache -vf ~/.local/share/fonts/ 
    echo "done!"
fi

CODE_DIR=$HOME/Code
mkdir -p $CODE_DIR
# update apt 
echo "Input password for: sudo apt-get update"
sudo apt update && sudo apt install nftables
# clash
git clone https://github.com/Kr328/clash-premium-installer $CODE_DIR/clash-premium-installer
sudo bash $CODE_DIR/clash-premium-installer/installer.sh install

# yacd
if ! [ -d "$HOME/.config/clash/public" ]; then 
    mkdir -p ~/.config/clash && cd ~/.config/clash
    wget https://github.com/haishanh/yacd/releases/download/v0.3.3/yacd.tar.xz 
    tar -xf yacd.tar.xz -C ~/.config/clash/
fi

{{ end -}}